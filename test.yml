pool:
  name: Mine

variables:
  Build.Folder.Drop.Base: 'C:\Users\Administrator\Downloads\taz\buildstaging$\IA.Core\AppServer\1.0.1'
  Build.Version.Count: '-100'
steps:
- task: PowerShell@1
  displayName: 'Update Build Version'
  inputs:
    scriptType: inlineScript
    arguments: '-buildTextPath "$(Build.Folder.Drop.Base)\BuildCount.txt"'
    inlineScript: |
     param($buildTextPath)
     
     if(!(Test-Path -Path $buildTextPath)){
       throw "Build Count file not found: $buildTextPath"
     }else{
       $oldCount = gc $buildTextPath
     
       if(!($oldCount -match "^[\d\.]+$")){
        throw "Invalid build Count: $oldCount"
       } else {
        $newCount = [int]$oldCount + 1
        echo "New Build Count: $newCount"
        sc $buildTextPath $newCount -Force
        Write-Host "##vso[task.setvariable variable=Build.Version.Count]$newCount"
       }
     }
